import{db,doc,onSnapshot}from"../shared/firebase.js";import{getLang,setLang,t}from"./i18n.js";export function applyTheme(){const e=localStorage.getItem("theme")||"dark",t=(e,t)=>document.documentElement.style.setProperty(e,t);e==="light"?(t("--bg","#f5f7fb"),t("--panel","#fff"),t("--panel2","#f2f5ff"),t("--text","#0f172a"),t("--muted","#51607c"),t("--border","rgba(15,23,42,.12)")):(t("--bg","#0b1218"),t("--panel","#0e1722"),t("--panel2","#0f1a2a"),t("--text","#e6eef6"),t("--muted","#9fb3c8"),t("--border","#1f2a44"))}export function initLangUI(){const e=document.querySelector(".brand");e&&(e.textContent=t("app_name"))}export function maintenanceGuard(){const e=doc(db,"app_settings","maintenance");onSnapshot(e,t=>{const n=t.exists()?t.data().status||"OFF":"OFF";if(n==="ON"){const n=t.data().message||"Mohon maaf, situs sedang perbaikan.";document.body.innerHTML=`<div style="min-height:100vh;display:grid;place-items:center;background:#0b1218;color:#e6eef6"><div style="text-align:center;max-width:520px;padding:24px"><h2 style="margin:0 0 10px">Perawatan</h2><p>${n}</p></div></div>`}})}export function toast(e){let t=document.getElementById("toast");t||(t=document.createElement("div"),t.id="toast",t.className="toast",document.body.appendChild(t)),t.textContent=e,t.style.display="block",setTimeout(()=>t.style.display="none",2200)}export function loadingOverlay(e=5){const t=document.createElement("div");t.style.cssText="position:fixed;inset:0;display:grid;place-items:center;background:rgba(0,0,0,.55);z-index:9999",t.innerHTML='<div style="width:72px;height:72px;border:6px solid rgba(255,255,255,.25);border-top-color:#fff;border-radius:999px;animation:spin 1s linear infinite"></div>',document.body.appendChild(t);const n=document.createElement("style");n.textContent="@keyframes spin{to{transform:rotate(360deg)}}",document.head.appendChild(n),setTimeout(()=>t.remove(),e*1e3)}export function boot(){applyTheme(),initLangUI(),maintenanceGuard();const e=document.getElementById("themePicker");e&&(e.value=localStorage.getItem("theme")||"dark",e.addEventListener("change",()=>{localStorage.setItem("theme",e.value),applyTheme()}));const t=document.getElementById("langPicker");t&&(t.value=getLang(),t.addEventListener("change",()=>{setLang(t.value),initLangUI()})),localStorage.getItem("showLoaderOnNext")==="1"&&(localStorage.removeItem("showLoaderOnNext"),loadingOverlay(5))}