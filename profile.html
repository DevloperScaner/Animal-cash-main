
<!doctype html>
<html lang="id">
<head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1">
<title>Profil â€” PETERNAKAN HEWAN</title><link rel="stylesheet" href="css/styles.css"></head>
<body>
<div class="header"><div class="inner">
  <div class="brand">Profil</div>
  <div class="actions"><button class="btn bad" data-logout>Logout</button><label class="toggle">â˜€ï¸<input data-theme-toggle type="checkbox">ğŸŒ™</label></div>
</div></div>
<div class="container">
  <div class="section card" id="info"></div>
  <div class="section card">
    <div style="font-weight:800;margin-bottom:8px">Riwayat Withdraw</div>
    <div id="wlist" class="grid"></div>
  </div>
</div>
<div class="tabbar"><div class="inner">
  <a href="dashboard.html" class="tab">ğŸ <div>Rumah</div></a>
  <a href="farm.html" class="tab">ğŸ®<div>Farm</div></a>
  <a href="invite.html" class="tab">âœ‰ï¸<div>Mengundang</div></a>
  <a href="profile.html" class="tab active">ğŸ‘¤<div>Aku</div></a>
</div></div>
<div id="toast" class="toast"></div>
<script type="module">
import { initTheme, requireAuth, initLogout } from './js/app.js';
import { db } from './js/app.js';
import { collection, query, where, orderBy, onSnapshot } from "https://www.gstatic.com/firebasejs/10.12.3/firebase-firestore.js";

initTheme();
requireAuth();
initLogout();
window.pageReady = async ()=>{
  const me = (window.App||{}).me;
  document.getElementById('info').innerHTML = `
    <div class="row" style="align-items:center;gap:12px">
      <div style="width:48px;height:48px;border-radius:50%;background:linear-gradient(135deg,rgba(76,201,240,.3),rgba(112,224,0,.25));border:1px solid var(--line)"></div>
      <div>
        <div style="font-weight:800">${me.displayName||'-'} ${me.verified ? 'âœ”ï¸' : ''}</div>
        <div class="small">Email: ${me.email||'-'}</div>
        <div class="small">UID: ${me.uid}</div>
        <div class="small">Role: ${me.role||'user'}</div>
      </div>
    </div>
    <div class="grid kpi" style="margin-top:12px">
      <div class="box"><div class="label">Saldo</div><div class="value">${(me.saldo||0).toLocaleString('id-ID',{style:'currency',currency:'IDR'})}</div></div>
      <div class="box"><div class="label">Ref Code</div><div class="value">${me.refCode||'-'}</div></div>
    </div>
  `;

  const q = query(collection(db, 'withdrawals'), where('userId','==', me.uid), orderBy('createdAt','desc'));
  onSnapshot(q, (snap)=>{
    const wlist = document.getElementById('wlist');
    wlist.innerHTML='';
    snap.forEach(d=>{
      const w = d.data();
      const el = document.createElement('div'); el.className='card';
      el.innerHTML = `<div class="row" style="justify-content:space-between">
        <div>${w.provider} â€¢ ${w.method}</div>
        <div>${(w.amount||0).toLocaleString('id-ID',{style:'currency',currency:'IDR'})}</div>
        <div>${(w.amountNet||0).toLocaleString('id-ID',{style:'currency',currency:'IDR'})}</div>
        <div>${w.status}</div></div>`;
      wlist.appendChild(el);
    });
  });
};
</script>
</body>
</html>
