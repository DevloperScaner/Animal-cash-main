
<!doctype html>
<html lang="id">
<head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1">
<title>PETERNAKAN HEWAN ‚Äî Login</title>
<link rel="stylesheet" href="css/styles.css">
</head>
<body>
<div class="loading-screen" id="loading" style="display:none">
  <div class="typing">ANIMAL CASH ‚Ä¢ PETERNAKAN HEWAN</div>
</div>

<div class="header">
  <div class="inner">
    <div class="brand">PETERNAKAN HEWAN</div>
    <label class="toggle">‚òÄÔ∏è<input data-theme-toggle type="checkbox">üåô</label>
  </div>
</div>

<div class="container">
  <div class="section card">
    <div style="font-weight:800">Masuk</div>
    <div class="row" style="margin-top:8px">
      <input id="lemail" class="input" placeholder="Email">
      <input id="lpass" class="input" placeholder="Password" type="password">
    </div>
    <div class="row" style="justify-content:flex-end"><button id="loginBtn" class="btn primary">Login</button></div>
  </div>
  <div class="section card">
    <div style="font-weight:800">Daftar</div>
    <div class="row" style="margin-top:8px">
      <input id="dname" class="input" placeholder="Nama">
      <input id="demail" class="input" placeholder="Email">
      <input id="dpass" class="input" placeholder="Password" type="password">
    </div>
    <div class="row">
      <input id="ref" class="input" placeholder="Kode referral (opsional)">
    </div>
    <div class="row" style="justify-content:flex-end"><button id="regBtn" class="btn good">Daftar</button></div>
  </div>
</div>

<div id="toast" class="toast"></div>
<script type="module">
import { firebaseConfig } from './js/config.js';
import { initTheme, toast } from './js/app.js';
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.3/firebase-app.js";
import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, updateProfile } from "https://www.gstatic.com/firebasejs/10.12.3/firebase-auth.js";
import { getFirestore, doc, setDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.12.3/firebase-firestore.js";

initTheme();
const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

// loading 5 detik setelah sukses login/daftar
function showLoadingThenGo(){
  const l = document.getElementById('loading');
  l.style.display='grid';
  setTimeout(()=> location.href = "dashboard.html", 5000);
}

document.getElementById('regBtn').onclick = async ()=>{
  try{
    const name = dname.value.trim();
    const email = demail.value.trim();
    const pass = dpass.value;
    const refBy = ref.value.trim() || null;
    if(!name || !email || pass.length<6) return toast("Isi data dengan benar");
    const cred = await createUserWithEmailAndPassword(auth, email, pass);
    await updateProfile(cred.user, { displayName: name });
    const uid = cred.user.uid;
    // generate short ref code
    const code = Math.random().toString(36).substring(2,8).toUpperCase();
    await setDoc(doc(db,"users",uid), {
      displayName: name, email, role:"user", saldo:0, verified:false,
      refCode: code, referredBy: refBy, createdAt: serverTimestamp()
    });
    toast("Registrasi sukses!");
    showLoadingThenGo();
  }catch(e){ toast(e.message); }
};

document.getElementById('loginBtn').onclick = async ()=>{
  try{
    const email = lemail.value.trim();
    const pass = lpass.value;
    const cred = await signInWithEmailAndPassword(auth, email, pass);
    toast("Login sukses");
    showLoadingThenGo();
  }catch(e){ toast(e.message); }
};
</script>
</body>
</html>
